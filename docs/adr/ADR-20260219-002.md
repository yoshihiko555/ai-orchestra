# ADR-20260219-002: startproject 実装フェーズの明示化と Codex 例外の厳格化

- **ステータス**: accepted
- **日付**: 2026-02-19
- **決定者**: yoshihiko

## コンテキスト

`startproject` スキル実行時、実装フェーズで `[Codex Suggestion]` が発火しても「軽微な変更」例外が過剰適用され、ほぼ全ての Edit/Write で Codex がスキップされていた。

根本原因は 2 つ:
1. `codex-suggestion-compliance.md` の例外「typo/コメント追加など軽微な変更」が曖昧で拡大解釈される
2. `startproject/SKILL.md` に明示的な Implementation Phase がなく `[Implementation...]` と省略されていたため、オーケストレーターが自由裁量で直接実装してしまう

## 検討した選択肢

### 選択肢 A: SKILL.md に Implementation Phase を追加 + 例外ルールの厳格化

- メリット: オーケストレーターの直接実装を禁止し、implementation agents 経由の委譲を強制できる
- メリット: 「軽微な変更」の定義を厳格化し、抜け道を排除できる
- デメリット: Phase 番号の繰り下げによる既存参照の更新が必要

### 選択肢 B: hook（check-codex-before-write.py）の判定ロジックを強化

- メリット: 技術的に強制力がある（ブロッキング hook にできる）
- デメリット: hook をブロッキングにすると柔軟性が失われる
- デメリット: hook 側の過度な複雑化

### 選択肢 C: 現状維持（ルール遵守をオーケストレーターに委ねる）

- メリット: 変更不要
- デメリット: 問題が解決しない

## 決定

**選択肢 A** を採用。ルール文書の明確化で対応し、hook ロジックは変更しない。

具体的な変更:
1. **`startproject/SKILL.md`**: Phase 6: Implementation を新設（旧 Phase 6 → Phase 7 に繰り下げ）。実装タスクは implementation agents にサブエージェント経由で委譲を必須化し、オーケストレーターの直接 Edit/Write を禁止
2. **`codex-suggestion-compliance.md`**: 「軽微な変更」例外を厳格化（対象: typo 1-2文字、コメント微修正のみ）。「累積的変更の原則」セクションを追加（3箇所以上の変更やスキル実行中は implementation agents 経由を原則化）
3. **`skill-review-policy.md`**: startproject のレビューフェーズ参照を Phase 7 に更新

## 影響

- `startproject` スキルの実装フェーズでオーケストレーターが直接コードを書くことが禁止される
- implementation agents（`frontend-dev`, `backend-python-dev` 等）経由の委譲が必須となり、Codex CLI の利用が自動的に強制される
- 単純な typo 修正や参照値更新は引き続きスキップ可能（柔軟性を維持）
- Codex 障害時のフォールバック規約は別途検討が必要（Codex フィードバックより）
