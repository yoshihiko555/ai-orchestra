<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1700" font-family="'Hiragino Kaku Gothic ProN', 'Segoe UI', system-ui, sans-serif">
  <defs>
    <linearGradient id="claudeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#E8D5B7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D4A574;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="codexGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#74AA9C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#5A8F82;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="geminiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8E7CC3;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6D5BA3;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="planGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#6FA8DC;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4A90C2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="designGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#93C47D;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6AA84F;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="implGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F6B26B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#E69138;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="reviewGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#E06666;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#CC4444;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="initGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#A4C2F4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6D9EEB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="startGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#B6D7A8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#93C47D;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="checkGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FFD966;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#F1C232;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrowhead-dashed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#999"/>
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4A90C2"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6AA84F"/>
    </marker>
    <marker id="arrowhead-yellow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#F1C232"/>
    </marker>
  </defs>

  <!-- 背景 -->
  <rect width="1400" height="1700" fill="#FAFAFA"/>

  <!-- ===== セクション1: システムアーキテクチャ ===== -->
  <text x="700" y="40" text-anchor="middle" font-size="28" font-weight="bold" fill="#333">AI Orchestra アーキテクチャ</text>
  <text x="700" y="65" text-anchor="middle" font-size="14" fill="#666">マルチエージェント協調フレームワーク</text>

  <!-- ユーザー -->
  <g transform="translate(650,85)">
    <circle cx="50" cy="20" r="15" fill="#555"/>
    <path d="M50,38 L50,60 M30,75 L50,60 L70,75 M35,45 L65,45" stroke="#555" stroke-width="3" fill="none"/>
    <text x="50" y="95" text-anchor="middle" font-size="12" fill="#555">ユーザー</text>
  </g>

  <!-- Claude Code (中央オーケストレーター) -->
  <g transform="translate(500,170)" filter="url(#shadow)">
    <rect width="400" height="100" rx="12" fill="url(#claudeGrad)" stroke="#B8956F" stroke-width="2"/>
    <text x="200" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#5A4030">Claude Code</text>
    <text x="200" y="50" text-anchor="middle" font-size="13" fill="#6B5040">オーケストレーター</text>
    <line x1="30" y1="60" x2="370" y2="60" stroke="#C9A678" stroke-width="1"/>
    <text x="200" y="80" text-anchor="middle" font-size="11" fill="#6B5040">タスク管理 | ユーザー対話 | エージェント調整</text>
  </g>

  <!-- ユーザーからClaudeへの矢印 -->
  <line x1="700" y1="135" x2="700" y2="165" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Codex CLI -->
  <g transform="translate(150,300)" filter="url(#shadow)">
    <rect width="240" height="90" rx="10" fill="url(#codexGrad)" stroke="#4A7A6D" stroke-width="2"/>
    <text x="120" y="28" text-anchor="middle" font-size="16" font-weight="bold" fill="#fff">Codex CLI</text>
    <text x="120" y="48" text-anchor="middle" font-size="11" fill="#E0F0ED">深い推論スペシャリスト</text>
    <line x1="20" y1="55" x2="220" y2="55" stroke="#7DBFB0" stroke-width="1"/>
    <text x="120" y="72" text-anchor="middle" font-size="10" fill="#E0F0ED">設計判断 | デバッグ | コードレビュー</text>
  </g>

  <!-- Gemini CLI -->
  <g transform="translate(1010,300)" filter="url(#shadow)">
    <rect width="240" height="90" rx="10" fill="url(#geminiGrad)" stroke="#5A4A8A" stroke-width="2"/>
    <text x="120" y="28" text-anchor="middle" font-size="16" font-weight="bold" fill="#fff">Gemini CLI</text>
    <text x="120" y="48" text-anchor="middle" font-size="11" fill="#E8E0F8">リサーチスペシャリスト</text>
    <line x1="20" y1="55" x2="220" y2="55" stroke="#A090D0" stroke-width="1"/>
    <text x="120" y="72" text-anchor="middle" font-size="10" fill="#E8E0F8">1Mトークン | マルチモーダル | Web検索</text>
  </g>

  <!-- サブエージェントボックス -->
  <g transform="translate(540,305)" filter="url(#shadow)">
    <rect width="320" height="80" rx="8" fill="#F5F5F5" stroke="#CCC" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="160" y="25" text-anchor="middle" font-size="13" font-weight="bold" fill="#666">サブエージェント</text>
    <text x="160" y="45" text-anchor="middle" font-size="11" fill="#888">コンテキスト保護レイヤー</text>
    <text x="160" y="62" text-anchor="middle" font-size="10" fill="#999">CLI呼び出し → 処理 → 要約返却</text>
  </g>

  <!-- Claudeからサブエージェントへの矢印 -->
  <path d="M700,270 L700,300" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- サブエージェントからCLIへの矢印 -->
  <path d="M540,345 L395,345" stroke="#999" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead-dashed)"/>
  <path d="M860,345 L1005,345" stroke="#999" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead-dashed)"/>

  <!-- 25の専門エージェント（コンパクト版） -->
  <g transform="translate(100,420)">
    <rect width="1200" height="180" rx="12" fill="#fff" stroke="#DDD" stroke-width="2"/>
    <text x="600" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#444">25の専門エージェント</text>

    <!-- 4カテゴリ横並び -->
    <g transform="translate(20,40)">
      <rect width="280" height="120" rx="6" fill="url(#planGrad)" opacity="0.9"/>
      <text x="140" y="22" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">計画</text>
      <text x="140" y="45" text-anchor="middle" font-size="10" fill="#fff">planner | researcher | requirements</text>
      <text x="140" y="70" text-anchor="middle" font-size="9" fill="#D0E8F8">タスク分解、調査、要件定義</text>
      <line x1="20" y1="85" x2="260" y2="85" stroke="#8FC0E0" stroke-width="1"/>
      <text x="140" y="105" text-anchor="middle" font-size="9" fill="#fff">spec-writer</text>
    </g>

    <g transform="translate(310,40)">
      <rect width="280" height="120" rx="6" fill="url(#designGrad)" opacity="0.9"/>
      <text x="140" y="22" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">設計</text>
      <text x="140" y="45" text-anchor="middle" font-size="10" fill="#fff">architect | api-designer</text>
      <text x="140" y="63" text-anchor="middle" font-size="10" fill="#fff">data-modeler | auth-designer</text>
      <line x1="20" y1="78" x2="260" y2="78" stroke="#B0D8A0" stroke-width="1"/>
      <text x="140" y="100" text-anchor="middle" font-size="9" fill="#E0F0D8">アーキテクチャ、API、DB、認証設計</text>
    </g>

    <g transform="translate(600,40)">
      <rect width="280" height="120" rx="6" fill="url(#implGrad)" opacity="0.9"/>
      <text x="140" y="22" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">実装</text>
      <text x="140" y="45" text-anchor="middle" font-size="10" fill="#fff">frontend-dev | backend-*-dev</text>
      <text x="140" y="63" text-anchor="middle" font-size="10" fill="#fff">ai-* | debugger | tester</text>
      <line x1="20" y1="78" x2="260" y2="78" stroke="#F8D0A0" stroke-width="1"/>
      <text x="140" y="100" text-anchor="middle" font-size="9" fill="#FFF0D8">コーディング、デバッグ、テスト</text>
    </g>

    <g transform="translate(890,40)">
      <rect width="280" height="120" rx="6" fill="url(#reviewGrad)" opacity="0.9"/>
      <text x="140" y="22" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">レビュー</text>
      <text x="140" y="45" text-anchor="middle" font-size="10" fill="#fff">code | security | performance</text>
      <text x="140" y="63" text-anchor="middle" font-size="10" fill="#fff">spec | arch | ux -reviewer</text>
      <line x1="20" y1="78" x2="260" y2="78" stroke="#F0A0A0" stroke-width="1"/>
      <text x="140" y="100" text-anchor="middle" font-size="9" fill="#F8D8D8">品質保証、docs-writer</text>
    </g>
  </g>

  <!-- ===== セクション2: /init-orchestra ワークフロー ===== -->
  <g transform="translate(0,630)">
    <rect x="50" y="0" width="1300" height="280" rx="12" fill="#F0F5FF" stroke="#A4C2F4" stroke-width="2"/>
    <text x="700" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#4A6FA5">/init-orchestra ワークフロー</text>
    <text x="700" y="50" text-anchor="middle" font-size="12" fill="#6080A0">プロジェクトでAI Orchestraを有効化</text>

    <!-- ステップ -->
    <g transform="translate(80,70)">
      <!-- Step 1 -->
      <g transform="translate(0,0)">
        <rect width="180" height="80" rx="6" fill="url(#initGrad)" stroke="#6D9EEB" stroke-width="1.5"/>
        <text x="90" y="25" text-anchor="middle" font-size="12" font-weight="bold" fill="#2A4A7A">1. 既存ファイル確認</text>
        <text x="90" y="45" text-anchor="middle" font-size="9" fill="#3A5A8A">.claude/settings.json</text>
        <text x="90" y="58" text-anchor="middle" font-size="9" fill="#3A5A8A">CLAUDE.md</text>
        <text x="90" y="71" text-anchor="middle" font-size="9" fill="#3A5A8A">.codex/ .gemini/</text>
      </g>
      <path d="M185,40 L215,40" stroke="#6D9EEB" stroke-width="2" marker-end="url(#arrowhead-blue)"/>

      <!-- Step 2 -->
      <g transform="translate(220,0)">
        <rect width="180" height="80" rx="6" fill="url(#initGrad)" stroke="#6D9EEB" stroke-width="1.5"/>
        <text x="90" y="25" text-anchor="middle" font-size="12" font-weight="bold" fill="#2A4A7A">2. settings.json</text>
        <text x="90" y="45" text-anchor="middle" font-size="9" fill="#3A5A8A">hooks設定を追加</text>
        <text x="90" y="58" text-anchor="middle" font-size="9" fill="#3A5A8A">permissions設定</text>
        <text x="90" y="71" text-anchor="middle" font-size="9" fill="#3A5A8A">既存があればマージ</text>
      </g>
      <path d="M405,40 L435,40" stroke="#6D9EEB" stroke-width="2" marker-end="url(#arrowhead-blue)"/>

      <!-- Step 3 -->
      <g transform="translate(440,0)">
        <rect width="180" height="80" rx="6" fill="url(#initGrad)" stroke="#6D9EEB" stroke-width="1.5"/>
        <text x="90" y="25" text-anchor="middle" font-size="12" font-weight="bold" fill="#2A4A7A">3. ディレクトリ作成</text>
        <text x="90" y="45" text-anchor="middle" font-size="9" fill="#3A5A8A">.claude/docs/</text>
        <text x="90" y="58" text-anchor="middle" font-size="9" fill="#3A5A8A">.claude/logs/</text>
        <text x="90" y="71" text-anchor="middle" font-size="9" fill="#3A5A8A">.claude/checkpoints/</text>
      </g>
      <path d="M625,40 L655,40" stroke="#6D9EEB" stroke-width="2" marker-end="url(#arrowhead-blue)"/>

      <!-- Step 4 -->
      <g transform="translate(660,0)">
        <rect width="180" height="80" rx="6" fill="url(#initGrad)" stroke="#6D9EEB" stroke-width="1.5"/>
        <text x="90" y="25" text-anchor="middle" font-size="12" font-weight="bold" fill="#2A4A7A">4. CLI設定配置</text>
        <text x="90" y="45" text-anchor="middle" font-size="9" fill="#3A5A8A">.codex/config.toml</text>
        <text x="90" y="58" text-anchor="middle" font-size="9" fill="#3A5A8A">.gemini/settings.json</text>
        <text x="90" y="71" text-anchor="middle" font-size="9" fill="#3A5A8A">AGENTS.md, GEMINI.md</text>
      </g>
      <path d="M845,40 L875,40" stroke="#6D9EEB" stroke-width="2" marker-end="url(#arrowhead-blue)"/>

      <!-- Step 5 -->
      <g transform="translate(880,0)">
        <rect width="180" height="80" rx="6" fill="url(#initGrad)" stroke="#6D9EEB" stroke-width="1.5"/>
        <text x="90" y="25" text-anchor="middle" font-size="12" font-weight="bold" fill="#2A4A7A">5. 完了レポート</text>
        <text x="90" y="45" text-anchor="middle" font-size="9" fill="#3A5A8A">作成ファイル一覧</text>
        <text x="90" y="58" text-anchor="middle" font-size="9" fill="#3A5A8A">スキップファイル一覧</text>
        <text x="90" y="71" text-anchor="middle" font-size="9" fill="#3A5A8A">次のステップ案内</text>
      </g>
    </g>

    <!-- Hooks一覧 -->
    <g transform="translate(80,170)">
      <rect width="1140" height="90" rx="6" fill="#E8F0FF" stroke="#B0C4DE" stroke-width="1"/>
      <text x="570" y="20" text-anchor="middle" font-size="12" font-weight="bold" fill="#4A6080">登録されるHooks</text>
      <g transform="translate(20,35)">
        <text x="0" y="0" font-size="9" fill="#5A7090">• agent-router.py (UserPromptSubmit) - エージェント/CLIルーティング提案</text>
        <text x="0" y="15" font-size="9" fill="#5A7090">• check-codex-before-write.py (PreToolUse) - 設計ファイル編集時にCodex提案</text>
        <text x="0" y="30" font-size="9" fill="#5A7090">• suggest-gemini-research.py (PreToolUse) - リサーチ時にGemini提案</text>
        <text x="380" y="0" font-size="9" fill="#5A7090">• check-codex-after-plan.py (PostToolUse) - Plan後にCodexレビュー提案</text>
        <text x="380" y="15" font-size="9" fill="#5A7090">• lint-on-save.py (PostToolUse) - Python編集後にruff/ty実行</text>
        <text x="380" y="30" font-size="9" fill="#5A7090">• log-cli-tools.py (PostToolUse) - Codex/Geminiログ記録</text>
        <text x="760" y="0" font-size="9" fill="#5A7090">• post-test-analysis.py - テスト失敗時分析</text>
        <text x="760" y="15" font-size="9" fill="#5A7090">• post-implementation-review.py - 大量変更後レビュー</text>
      </g>
    </g>
  </g>

  <!-- ===== セクション3: /startproject ワークフロー ===== -->
  <g transform="translate(0,940)">
    <rect x="50" y="0" width="1300" height="340" rx="12" fill="#F0FFF0" stroke="#93C47D" stroke-width="2"/>
    <text x="700" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#4A8050">/startproject ワークフロー</text>
    <text x="700" y="50" text-anchor="middle" font-size="12" fill="#608060">マルチエージェント協調でプロジェクト開始</text>

    <!-- Phase 1-3 (上段) -->
    <g transform="translate(80,70)">
      <!-- Phase 1 -->
      <g transform="translate(0,0)">
        <rect width="200" height="100" rx="6" fill="url(#geminiGrad)" stroke="#6D5BA3" stroke-width="1.5"/>
        <text x="100" y="22" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Phase 1: リサーチ</text>
        <text x="100" y="40" text-anchor="middle" font-size="10" fill="#E8E0F8">Gemini (サブエージェント)</text>
        <line x1="15" y1="50" x2="185" y2="50" stroke="#A090D0" stroke-width="1"/>
        <text x="100" y="65" text-anchor="middle" font-size="9" fill="#fff">リポジトリ構造分析</text>
        <text x="100" y="78" text-anchor="middle" font-size="9" fill="#fff">既存コード・パターン調査</text>
        <text x="100" y="91" text-anchor="middle" font-size="9" fill="#fff">→ docs/research/{機能}.md</text>
      </g>
      <path d="M205,50 L235,50" stroke="#6AA84F" stroke-width="2" marker-end="url(#arrowhead-green)"/>

      <!-- Phase 2 -->
      <g transform="translate(240,0)">
        <rect width="200" height="100" rx="6" fill="url(#claudeGrad)" stroke="#B8956F" stroke-width="1.5"/>
        <text x="100" y="22" text-anchor="middle" font-size="11" font-weight="bold" fill="#5A4030">Phase 2: 要件定義</text>
        <text x="100" y="40" text-anchor="middle" font-size="10" fill="#6B5040">Claude (ユーザー対話)</text>
        <line x1="15" y1="50" x2="185" y2="50" stroke="#C9A678" stroke-width="1"/>
        <text x="100" y="65" text-anchor="middle" font-size="9" fill="#5A4030">目的・スコープ確認</text>
        <text x="100" y="78" text-anchor="middle" font-size="9" fill="#5A4030">技術要件・成功基準</text>
        <text x="100" y="91" text-anchor="middle" font-size="9" fill="#5A4030">→ 実装計画ドラフト作成</text>
      </g>
      <path d="M445,50 L475,50" stroke="#6AA84F" stroke-width="2" marker-end="url(#arrowhead-green)"/>

      <!-- Phase 3 -->
      <g transform="translate(480,0)">
        <rect width="200" height="100" rx="6" fill="url(#codexGrad)" stroke="#4A7A6D" stroke-width="1.5"/>
        <text x="100" y="22" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Phase 3: 設計レビュー</text>
        <text x="100" y="40" text-anchor="middle" font-size="10" fill="#E0F0ED">Codex (サブエージェント)</text>
        <line x1="15" y1="50" x2="185" y2="50" stroke="#7DBFB0" stroke-width="1"/>
        <text x="100" y="65" text-anchor="middle" font-size="9" fill="#fff">アプローチ評価</text>
        <text x="100" y="78" text-anchor="middle" font-size="9" fill="#fff">リスク分析</text>
        <text x="100" y="91" text-anchor="middle" font-size="9" fill="#fff">→ 改善提案</text>
      </g>
    </g>

    <!-- Phase 4-6 (下段) -->
    <g transform="translate(80,190)">
      <!-- Phase 4 -->
      <g transform="translate(0,0)">
        <rect width="200" height="100" rx="6" fill="url(#claudeGrad)" stroke="#B8956F" stroke-width="1.5"/>
        <text x="100" y="22" text-anchor="middle" font-size="11" font-weight="bold" fill="#5A4030">Phase 4: タスク作成</text>
        <text x="100" y="40" text-anchor="middle" font-size="10" fill="#6B5040">Claude</text>
        <line x1="15" y1="50" x2="185" y2="50" stroke="#C9A678" stroke-width="1"/>
        <text x="100" y="65" text-anchor="middle" font-size="9" fill="#5A4030">サブエージェント要約を統合</text>
        <text x="100" y="78" text-anchor="middle" font-size="9" fill="#5A4030">TaskCreate でタスク登録</text>
        <text x="100" y="91" text-anchor="middle" font-size="9" fill="#5A4030">→ 進捗トラッキング開始</text>
      </g>
      <path d="M205,50 L235,50" stroke="#6AA84F" stroke-width="2" marker-end="url(#arrowhead-green)"/>

      <!-- Phase 5 -->
      <g transform="translate(240,0)">
        <rect width="200" height="100" rx="6" fill="url(#startGrad)" stroke="#6AA84F" stroke-width="1.5"/>
        <text x="100" y="22" text-anchor="middle" font-size="11" font-weight="bold" fill="#2A5030">Phase 5: CLAUDE.md更新</text>
        <text x="100" y="40" text-anchor="middle" font-size="10" fill="#3A6040">セッション永続化</text>
        <line x1="15" y1="50" x2="185" y2="50" stroke="#93C47D" stroke-width="1"/>
        <text x="100" y="65" text-anchor="middle" font-size="9" fill="#2A5030">プロジェクトコンテキスト</text>
        <text x="100" y="78" text-anchor="middle" font-size="9" fill="#2A5030">設計決定事項</text>
        <text x="100" y="91" text-anchor="middle" font-size="9" fill="#2A5030">→ 別セッションでも参照可能</text>
      </g>
      <path d="M445,50 L475,50" stroke="#6AA84F" stroke-width="2" marker-end="url(#arrowhead-green)"/>

      <!-- Implementation -->
      <g transform="translate(480,0)">
        <rect width="160" height="100" rx="6" fill="url(#implGrad)" stroke="#E69138" stroke-width="1.5"/>
        <text x="80" y="22" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">[実装フェーズ]</text>
        <line x1="15" y1="35" x2="145" y2="35" stroke="#F8D0A0" stroke-width="1"/>
        <text x="80" y="55" text-anchor="middle" font-size="9" fill="#fff">エージェントが実装</text>
        <text x="80" y="70" text-anchor="middle" font-size="9" fill="#fff">タスク完了を記録</text>
        <text x="80" y="85" text-anchor="middle" font-size="9" fill="#fff">設計変更はDESIGN.mdへ</text>
      </g>
      <path d="M645,50 L675,50" stroke="#6AA84F" stroke-width="2" marker-end="url(#arrowhead-green)"/>

      <!-- Phase 6 -->
      <g transform="translate(680,0)">
        <rect width="200" height="100" rx="6" fill="url(#reviewGrad)" stroke="#CC4444" stroke-width="1.5"/>
        <text x="100" y="22" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Phase 6: レビュー</text>
        <text x="100" y="40" text-anchor="middle" font-size="10" fill="#F8D8D8">別セッション or Codex</text>
        <line x1="15" y1="50" x2="185" y2="50" stroke="#F0A0A0" stroke-width="1"/>
        <text x="100" y="65" text-anchor="middle" font-size="9" fill="#fff">新セッション: git diff分析</text>
        <text x="100" y="78" text-anchor="middle" font-size="9" fill="#fff">Codex: 深い品質分析</text>
        <text x="100" y="91" text-anchor="middle" font-size="9" fill="#fff">→ バイアスなしレビュー</text>
      </g>
    </g>

    <!-- 接続矢印 (上段→下段) -->
    <path d="M780,170 L780,185 L100,185 L100,190" stroke="#6AA84F" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  </g>

  <!-- ===== セクション4: /checkpointing ワークフロー ===== -->
  <g transform="translate(0,1310)">
    <rect x="50" y="0" width="1300" height="360" rx="12" fill="#FFFEF0" stroke="#F1C232" stroke-width="2"/>
    <text x="700" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#8A7020">/checkpointing ワークフロー</text>
    <text x="700" y="50" text-anchor="middle" font-size="12" fill="#A09030">セッションコンテキストの永続化とスキル抽出</text>

    <!-- 3つのモード -->
    <g transform="translate(80,70)">
      <!-- Mode 1 -->
      <g transform="translate(0,0)">
        <rect width="360" height="130" rx="6" fill="#FFF8E0" stroke="#E6D060" stroke-width="1.5"/>
        <text x="180" y="22" text-anchor="middle" font-size="13" font-weight="bold" fill="#6A5A10">Mode 1: Session History（デフォルト）</text>
        <line x1="20" y1="35" x2="340" y2="35" stroke="#E6D060" stroke-width="1"/>
        <text x="180" y="55" text-anchor="middle" font-size="10" fill="#7A6A20">/checkpointing</text>

        <g transform="translate(20,65)">
          <rect width="100" height="50" rx="4" fill="#FFF0C0" stroke="#D4C040"/>
          <text x="50" y="20" text-anchor="middle" font-size="9" fill="#6A5A10">cli-tools.jsonl</text>
          <text x="50" y="35" text-anchor="middle" font-size="8" fill="#8A7A30">ログ解析</text>
        </g>
        <path d="M125,90 L145,90" stroke="#D4C040" stroke-width="1.5" marker-end="url(#arrowhead-yellow)"/>
        <g transform="translate(150,65)">
          <rect width="60" height="50" rx="4" fill="#FFF0C0" stroke="#D4C040"/>
          <text x="30" y="20" text-anchor="middle" font-size="8" fill="#6A5A10">CLAUDE</text>
          <text x="30" y="35" text-anchor="middle" font-size="8" fill="#6A5A10">.md</text>
        </g>
        <g transform="translate(220,65)">
          <rect width="60" height="50" rx="4" fill="#FFF0C0" stroke="#D4C040"/>
          <text x="30" y="20" text-anchor="middle" font-size="8" fill="#6A5A10">AGENTS</text>
          <text x="30" y="35" text-anchor="middle" font-size="8" fill="#6A5A10">.md</text>
        </g>
        <g transform="translate(290,65)">
          <rect width="55" height="50" rx="4" fill="#FFF0C0" stroke="#D4C040"/>
          <text x="27" y="20" text-anchor="middle" font-size="8" fill="#6A5A10">GEMINI</text>
          <text x="27" y="35" text-anchor="middle" font-size="8" fill="#6A5A10">.md</text>
        </g>
      </g>

      <!-- Mode 2 -->
      <g transform="translate(390,0)">
        <rect width="360" height="130" rx="6" fill="url(#checkGrad)" stroke="#E6B800" stroke-width="1.5"/>
        <text x="180" y="22" text-anchor="middle" font-size="13" font-weight="bold" fill="#5A4A00">Mode 2: Full Checkpoint（--full）</text>
        <line x1="20" y1="35" x2="340" y2="35" stroke="#D4A800" stroke-width="1"/>
        <text x="180" y="55" text-anchor="middle" font-size="10" fill="#6A5A10">/checkpointing --full</text>

        <g transform="translate(20,65)">
          <rect width="150" height="50" rx="4" fill="#FFF8D0" stroke="#D4B030"/>
          <text x="75" y="15" text-anchor="middle" font-size="8" fill="#5A4A00">git log + diff</text>
          <text x="75" y="28" text-anchor="middle" font-size="8" fill="#5A4A00">cli-tools.jsonl</text>
          <text x="75" y="41" text-anchor="middle" font-size="8" fill="#7A6A20">データ収集</text>
        </g>
        <path d="M175,90 L195,90" stroke="#D4A800" stroke-width="1.5" marker-end="url(#arrowhead-yellow)"/>
        <g transform="translate(200,65)">
          <rect width="140" height="50" rx="4" fill="#FFF8D0" stroke="#D4B030"/>
          <text x="70" y="15" text-anchor="middle" font-size="8" fill="#5A4A00">.claude/checkpoints/</text>
          <text x="70" y="28" text-anchor="middle" font-size="8" fill="#5A4A00">YYYY-MM-DD-HHMMSS.md</text>
          <text x="70" y="41" text-anchor="middle" font-size="8" fill="#7A6A20">包括的スナップショット</text>
        </g>
      </g>

      <!-- Mode 3 -->
      <g transform="translate(780,0)">
        <rect width="420" height="130" rx="6" fill="#FFE680" stroke="#D4A000" stroke-width="2"/>
        <text x="210" y="22" text-anchor="middle" font-size="13" font-weight="bold" fill="#4A3A00">Mode 3: Skill Analysis（--full --analyze）</text>
        <line x1="20" y1="35" x2="400" y2="35" stroke="#C49000" stroke-width="1"/>
        <text x="210" y="55" text-anchor="middle" font-size="10" fill="#5A4A00">/checkpointing --full --analyze</text>

        <g transform="translate(15,65)">
          <rect width="85" height="50" rx="4" fill="#FFF0A0" stroke="#C4A020"/>
          <text x="42" y="20" text-anchor="middle" font-size="8" fill="#4A3A00">checkpoint</text>
          <text x="42" y="35" text-anchor="middle" font-size="8" fill="#6A5A10">生成</text>
        </g>
        <path d="M105,90 L120,90" stroke="#C49000" stroke-width="1.5" marker-end="url(#arrowhead-yellow)"/>
        <g transform="translate(125,65)">
          <rect width="85" height="50" rx="4" fill="#FFF0A0" stroke="#C4A020"/>
          <text x="42" y="20" text-anchor="middle" font-size="8" fill="#4A3A00">analyze</text>
          <text x="42" y="35" text-anchor="middle" font-size="8" fill="#6A5A10">prompt生成</text>
        </g>
        <path d="M215,90 L230,90" stroke="#C49000" stroke-width="1.5" marker-end="url(#arrowhead-yellow)"/>
        <g transform="translate(235,65)">
          <rect width="85" height="50" rx="4" fill="#FFF0A0" stroke="#C4A020"/>
          <text x="42" y="20" text-anchor="middle" font-size="8" fill="#4A3A00">subagent</text>
          <text x="42" y="35" text-anchor="middle" font-size="8" fill="#6A5A10">パターン抽出</text>
        </g>
        <path d="M325,90 L340,90" stroke="#C49000" stroke-width="1.5" marker-end="url(#arrowhead-yellow)"/>
        <g transform="translate(345,65)">
          <rect width="60" height="50" rx="4" fill="#FFE060" stroke="#B49010"/>
          <text x="30" y="20" text-anchor="middle" font-size="8" fill="#3A2A00">skills/</text>
          <text x="30" y="35" text-anchor="middle" font-size="8" fill="#5A4A00">追加</text>
        </g>
      </g>
    </g>

    <!-- 出力例とユースケース -->
    <g transform="translate(80,220)">
      <!-- Full Checkpoint 出力例 -->
      <g transform="translate(0,0)">
        <rect width="400" height="120" rx="6" fill="#FFF8E8" stroke="#E0D0A0" stroke-width="1"/>
        <text x="200" y="20" text-anchor="middle" font-size="11" font-weight="bold" fill="#6A5A20">Full Checkpoint 出力例</text>
        <line x1="15" y1="30" x2="385" y2="30" stroke="#E0D0A0" stroke-width="1"/>
        <text x="20" y="48" font-size="9" fill="#5A4A10">## Summary</text>
        <text x="20" y="62" font-size="9" fill="#7A6A30">- Commits: 5 | Files: 12 (8 modified, 3 created)</text>
        <text x="20" y="76" font-size="9" fill="#7A6A30">- Codex consultations: 3 | Gemini researches: 2</text>
        <text x="20" y="93" font-size="9" fill="#5A4A10">## Git History | ## CLI Consultations</text>
        <text x="20" y="107" font-size="9" fill="#7A6A30">コミット一覧、ファイル変更、相談ログ</text>
      </g>

      <!-- 発見パターン例 -->
      <g transform="translate(420,0)">
        <rect width="400" height="120" rx="6" fill="#FFF0D0" stroke="#D4B060" stroke-width="1"/>
        <text x="200" y="20" text-anchor="middle" font-size="11" font-weight="bold" fill="#5A4A00">Skill Analysis で発見するパターン例</text>
        <line x1="15" y1="30" x2="385" y2="30" stroke="#D4B060" stroke-width="1"/>
        <text x="20" y="50" font-size="9" fill="#6A5A10">• テスト→実装の繰り返し（TDDワークフロー）</text>
        <text x="20" y="66" font-size="9" fill="#6A5A10">• リサーチ→設計→実装の流れ</text>
        <text x="20" y="82" font-size="9" fill="#6A5A10">• 特定ファイルセットの同時変更パターン</text>
        <text x="20" y="98" font-size="9" fill="#6A5A10">• CLI相談→コード変更のシーケンス</text>
        <text x="20" y="112" font-size="9" fill="#8A7A30">→ 再利用可能なスキルとして skills/ に追加</text>
      </g>

      <!-- 実行タイミング -->
      <g transform="translate(840,0)">
        <rect width="360" height="120" rx="6" fill="#F8F0E0" stroke="#C0B080" stroke-width="1"/>
        <text x="180" y="20" text-anchor="middle" font-size="11" font-weight="bold" fill="#5A4A20">推奨実行タイミング</text>
        <line x1="15" y1="30" x2="345" y2="30" stroke="#C0B080" stroke-width="1"/>
        <text x="20" y="50" font-size="9" fill="#6A5A10">• セッション終了前 → --full --analyze</text>
        <text x="20" y="66" font-size="9" fill="#6A5A10">• 重要な設計決定後 → --full</text>
        <text x="20" y="82" font-size="9" fill="#6A5A10">• 大きな機能実装完了後 → --full --analyze</text>
        <text x="20" y="98" font-size="9" fill="#6A5A10">• 日次の軽い記録 → デフォルト</text>
        <text x="20" y="112" font-size="9" fill="#8A7A30">→ 作業パターンを蓄積・スキル化</text>
      </g>
    </g>
  </g>

  <!-- 凡例 -->
  <g transform="translate(1050,85)">
    <rect width="280" height="90" rx="6" fill="#fff" stroke="#DDD" stroke-width="1"/>
    <text x="140" y="18" text-anchor="middle" font-size="11" font-weight="bold" fill="#555">凡例</text>
    <rect x="15" y="30" width="14" height="14" fill="url(#claudeGrad)" rx="2"/>
    <text x="35" y="41" font-size="9" fill="#666">Claude (統括)</text>
    <rect x="100" y="30" width="14" height="14" fill="url(#codexGrad)" rx="2"/>
    <text x="120" y="41" font-size="9" fill="#666">Codex (推論)</text>
    <rect x="185" y="30" width="14" height="14" fill="url(#geminiGrad)" rx="2"/>
    <text x="205" y="41" font-size="9" fill="#666">Gemini (リサーチ)</text>
    <line x1="15" y1="60" x2="45" y2="60" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="55" y="64" font-size="9" fill="#666">直接呼出</text>
    <line x1="120" y1="60" x2="150" y2="60" stroke="#999" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead-dashed)"/>
    <text x="160" y="64" font-size="9" fill="#666">サブエージェント経由</text>
    <text x="15" y="82" font-size="8" fill="#888">※ Codex/Geminiはサブエージェント経由でコンテキスト保護</text>
  </g>
</svg>
